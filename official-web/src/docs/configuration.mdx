# 配置说明

Dict-Hub 支持通过配置文件和环境变量进行配置。

## 配置文件

配置文件位于 `configs/config.yaml`，Docker 部署时位于 `/app/configs/config.yaml`。

### 完整配置示例

```yaml
server:
  port: 8080
  mode: production  # development 或 production

database:
  driver: sqlite
  path: ./data/dictionary.db

log:
  level: info       # debug, info, warn, error
  format: json      # json 或 text

cors:
  allowed_origins:
    - http://localhost:3000
    - http://localhost:5173
  allowed_methods:
    - GET
    - POST
    - PUT
    - DELETE
    - OPTIONS
  allowed_headers:
    - Origin
    - Content-Type
    - Authorization

mdx:
  dict_dir: ./dicts
  source_dir: ./dicts/source
  sound_dir: ./dicts/sound
  auto_load: true
```

## 配置项说明

### 服务器配置 (server)

| 配置项 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `port` | int | `8080` | HTTP 服务端口 |
| `mode` | string | `production` | 运行模式，影响日志输出和调试信息 |

### 数据库配置 (database)

| 配置项 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `driver` | string | `sqlite` | 数据库驱动，目前仅支持 sqlite |
| `path` | string | `./data/dictionary.db` | 数据库文件路径 |

### 日志配置 (log)

| 配置项 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `level` | string | `info` | 日志级别：debug, info, warn, error |
| `format` | string | `json` | 日志格式：json 或 text |

### MDX 配置 (mdx)

| 配置项 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `dict_dir` | string | `./dicts` | 词典根目录 |
| `source_dir` | string | `./dicts/source` | MDX 词典文件目录 |
| `sound_dir` | string | `./dicts/sound` | MDD 音频文件目录 |
| `auto_load` | bool | `true` | 启动时自动加载词典 |

## 环境变量

所有配置都可以通过环境变量覆盖，格式为大写加下划线：

| 环境变量 | 对应配置 | 示例 |
|----------|----------|------|
| `SERVER_PORT` | server.port | `8080` |
| `SERVER_MODE` | server.mode | `production` |
| `DATABASE_PATH` | database.path | `/app/data/dictionary.db` |
| `LOG_LEVEL` | log.level | `info` |
| `LOG_FORMAT` | log.format | `json` |
| `MDX_DICT_DIR` | mdx.dict_dir | `/app/dicts` |
| `MDX_SOURCE_DIR` | mdx.source_dir | `/app/dicts/source` |
| `MDX_SOUND_DIR` | mdx.sound_dir | `/app/dicts/sound` |
| `MDX_AUTO_LOAD` | mdx.auto_load | `true` |

### Docker 环境变量示例

```yaml
services:
  dict-hub:
    image: dongdonghe122/dict-hub:latest
    environment:
      - SERVER_PORT=8080
      - SERVER_MODE=production
      - DATABASE_PATH=/app/data/dictionary.db
      - MDX_DICT_DIR=/app/dicts
      - MDX_SOURCE_DIR=/app/dicts/source
      - MDX_SOUND_DIR=/app/dicts/sound
      - MDX_AUTO_LOAD=true
      - LOG_LEVEL=info
      - TZ=Asia/Shanghai
```

## 生产环境建议

### 1. 运行模式

生产环境建议设置：

```yaml
server:
  mode: production

log:
  level: info
  format: json
```

### 2. 数据持久化

确保数据库和词典目录使用持久化存储：

```yaml
database:
  path: /app/data/dictionary.db

mdx:
  dict_dir: /app/dicts
```

Docker 部署时挂载数据卷：

```bash
docker run -d \
  -v ./data:/app/data \
  -v ./dicts:/app/dicts \
  dongdonghe122/dict-hub:latest
```

### 3. CORS 配置

生产环境需要配置正确的允许源：

```yaml
cors:
  allowed_origins:
    - https://your-domain.com
```

## 配置优先级

配置加载优先级（从高到低）：

1. 环境变量
2. 配置文件
3. 默认值

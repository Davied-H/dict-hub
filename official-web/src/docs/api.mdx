# API 接口

Dict-Hub 提供完整的 RESTful API 接口，支持词条查询、词典管理、历史记录等功能。

## 基础信息

- **Base URL**: `http://localhost:8080/api/v1`
- **Content-Type**: `application/json`
- **响应格式**: JSON

## 搜索接口

### 搜索词条

搜索所有已启用词典中的词条。

```http
GET /api/v1/search?word={keyword}
```

**参数：**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `word` | string | 是 | 搜索关键词 |

**响应示例：**

```json
{
  "code": 0,
  "data": {
    "results": [
      {
        "dict_id": "oxford",
        "dict_name": "牛津高阶",
        "entries": [
          {
            "word": "hello",
            "definition": "<div class=\"entry\">...</div>"
          }
        ]
      }
    ],
    "total": 5
  }
}
```

### 搜索建议

获取自动补全建议。

```http
GET /api/v1/search/suggest?q={query}&limit={limit}
```

**参数：**

| 参数 | 类型 | 必填 | 默认值 | 说明 |
|------|------|------|--------|------|
| `q` | string | 是 | - | 输入的前缀 |
| `limit` | int | 否 | `10` | 返回建议数量上限 |

**响应示例：**

```json
{
  "code": 0,
  "data": {
    "suggestions": ["hello", "help", "helmet", "helpful"]
  }
}
```

## 词典管理接口

### 获取词典列表

获取所有词典源信息。

```http
GET /api/v1/dictionaries
```

**响应示例：**

```json
{
  "code": 0,
  "data": {
    "dictionaries": [
      {
        "id": "oxford",
        "name": "牛津高阶英汉双解词典",
        "path": "/app/dicts/source/oxford.mdx",
        "enabled": true,
        "entry_count": 120000,
        "order": 1
      }
    ]
  }
}
```

### 获取已加载词典

获取当前已加载到内存的词典。

```http
GET /api/v1/dicts
```

**响应示例：**

```json
{
  "code": 0,
  "data": {
    "dicts": [
      {
        "id": "oxford",
        "name": "牛津高阶",
        "entry_count": 120000
      }
    ]
  }
}
```

### 切换词典状态

启用或禁用词典。

```http
PUT /api/v1/dictionaries/:id/toggle
```

**参数：**

| 参数 | 位置 | 类型 | 说明 |
|------|------|------|------|
| `id` | path | string | 词典 ID |

**响应示例：**

```json
{
  "code": 0,
  "message": "词典状态已更新",
  "data": {
    "enabled": true
  }
}
```

### 调整词典顺序

调整词典在搜索结果中的显示顺序。

```http
PUT /api/v1/dictionaries/reorder
```

**请求体：**

```json
{
  "order": ["oxford", "longman", "collins"]
}
```

### 删除词典

从系统中删除词典。

```http
DELETE /api/v1/dictionaries/:id
```

## 词条查询接口

### 查询单个词典

在指定词典中查询词条。

```http
GET /api/v1/dicts/:id/lookup?word={word}
```

**参数：**

| 参数 | 位置 | 类型 | 说明 |
|------|------|------|------|
| `id` | path | string | 词典 ID |
| `word` | query | string | 要查询的单词 |

### 获取词典资源

获取词典中的 CSS、图片等资源文件。

```http
GET /api/v1/dicts/:id/resource/*path
```

## 音频接口

### 获取单词音频

获取单词的发音音频。

```http
GET /api/v1/audio/:word
```

**参数：**

| 参数 | 位置 | 类型 | 说明 |
|------|------|------|------|
| `word` | path | string | 单词 |

**响应：**

- Content-Type: `audio/mpeg` 或 `audio/wav`
- 返回音频文件二进制数据

### 检查音频可用性

检查单词是否有可用的音频资源。

```http
GET /api/v1/audio/:word/availability
```

**响应示例：**

```json
{
  "code": 0,
  "data": {
    "available": true,
    "sources": ["oxford", "longman"]
  }
}
```

## 历史记录接口

### 获取查询历史

获取用户的查询历史记录。

```http
GET /api/v1/history?page={page}&limit={limit}
```

**参数：**

| 参数 | 类型 | 必填 | 默认值 | 说明 |
|------|------|------|--------|------|
| `page` | int | 否 | `1` | 页码 |
| `limit` | int | 否 | `20` | 每页数量 |

**响应示例：**

```json
{
  "code": 0,
  "data": {
    "records": [
      {
        "id": 1,
        "word": "hello",
        "query_time": "2024-01-15T10:30:00Z",
        "query_count": 3
      }
    ],
    "total": 100,
    "page": 1,
    "limit": 20
  }
}
```

### 清空历史记录

清空所有查询历史。

```http
DELETE /api/v1/history
```

**响应示例：**

```json
{
  "code": 0,
  "message": "历史记录已清空"
}
```

### 导出历史记录

导出查询历史为文件。

```http
GET /api/v1/history/export
```

**响应：**

- Content-Type: `text/csv`
- 返回 CSV 格式的历史记录

## 词频接口

### 导入词频数据

导入词频统计数据。

```http
POST /api/v1/wordfreq/import
```

**请求体（multipart/form-data）：**

| 字段 | 类型 | 说明 |
|------|------|------|
| `file` | file | 词频数据文件（CSV/TXT） |

## 健康检查

### 检查服务状态

```http
GET /health
```

**响应示例：**

```json
{
  "status": "ok",
  "version": "1.0.0"
}
```

## 错误响应

所有接口在发生错误时返回统一格式：

```json
{
  "code": 1001,
  "message": "错误描述信息"
}
```

### 错误码说明

| 错误码 | 说明 |
|--------|------|
| `0` | 成功 |
| `1001` | 参数错误 |
| `1002` | 词典未找到 |
| `1003` | 词条未找到 |
| `1004` | 资源未找到 |
| `5000` | 服务器内部错误 |

## 静态资源

### 词典资源目录

```http
GET /dict-assets/{filename}
```

用于访问词典中的 CSS、图片等静态资源。

### 通用静态资源

```http
GET /static/{path}
```

用于访问词典目录下的其他静态文件。
